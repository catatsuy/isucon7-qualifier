upstream store1 {
  server 192.168.101.1:8080;
}

upstream store2 {
  server 192.168.101.2:8080;
}

server {
        listen 80 default_server;
        listen [::]:80 default_server;

        client_max_body_size 20M;

        root /home/isucon/isubata/webapp/public;

	proxy_http_version 1.1;
	proxy_set_header Connection "";
	proxy_set_header Host $http_host;

	proxy_http_version 1.1;
	proxy_request_buffering off;
	location = /favicon.ico {
		# access_log off;
		expires 1d;
		#  empty_gif
	}
        location = /js/jquery.min.js {
                expires 1d;
        }
        location = /fonts/glyphicons-halflings-regular.svg {
                expires 1d;
        } 
	location ^~ /fonts/ {
		expires 1d;
	}
	location ^~ /js/ {
		expires 1d;
	}
	location ^~ /css/ {
		expires 1d;
	}
	
	# store1
	location /icons/0 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/1 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/2 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/3 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/4 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/5 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/6 {
		expires 1d;
		proxy_pass http://store1;
	}
	location /icons/7 {
		expires 1d;
		proxy_pass http://store1;
	}

	# store2
	location /icons/8 {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/9 {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/a {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/b {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/c {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/d {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/e {
		expires 1d;
		proxy_pass http://store2;
	}
	location /icons/f {
		expires 1d;
		proxy_pass http://store2;
	}

        location / {
                proxy_pass http://127.0.0.1:5000;
        }
}

server {
	listen 8080;
	client_max_body_size 50M;

        root /home/isucon/isubata/webapp/webdav;
	
	location / {
                create_full_put_path  on;
		dav_access user:rw group:rw all:r;
		dav_methods PUT DELETE MKCOL COPY MOVE;
	}
}
